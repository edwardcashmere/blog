---
- hosts: localhost
  become: true
  remote_user: root

  pre_tasks: 
    - name: update repositories
      apt:
        update_cache: yes
      changed_when: False

  tasks:
    - include: infrastructure/install_cron_job.yml
    - name: pull down branch from main using git
      git:
        repo: https://github.com/edwardcashmere/blog
        dest: /var/www
        version: main

    - name: Install asdf
      ansible.builtin.git:
        repo: https://github.com/asdf-vm/asdf.git
        dest: "/Users/{{ lookup('env', 'USER') }}/.asdf"
        version: v0.13.1
    - name: Install plugins
      ansible.builtin.shell: |
        source /Users/{{ lookup('env', 'USER') }}/.asdf/asdf.sh
        asdf plugin-add {{ item }} || exit 0
      with_items:
        - erlang
        - elixir
        - nodejs
    # - name: Install Linux support packages
    #   apt:
    #     name: 
    #       - build-essential 
    #       - libssl-dev 
    #       - make 
    #       - automake 
    #       - autoconf 
    #       - libncurses5-dev 
    #       - gcc 
    #       - g++ 
    #       - openjdk-11-jdk
    # - name: Install Project packages
    #   ansible.builtin.command: "asdf install"
    #   args:
    #     chdir: /var/www
    - name: Install Phoenix
      ansible.builtin.command: "mix archive.install hex"
      args:
        chdir: /var/www
    - name: Install Project Deps
      ansible.builtin.command: "mix deps.get && mix compile"
      args:
        chdir: /var/www
    # - name: install asdf

    # - name: install erlang elixir nodjs
    #   command: 
    #     cmd: asdf install







    
